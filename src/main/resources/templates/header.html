<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <link rel="stylesheet" th:href="@{/css/header.css}">
</head>

<body>
  <header class="header">
    <div class="icon-store">
      <a href="/fashionshop" class="logo">
        <img th:src="@{/images/store.png}" alt="Logo" class="logo-img" />
        <span class="logo-text">Fashion Shop</span>
      </a>
    </div>

    <nav class="link-home">
      <a href="/fashionshop" th:classappend="${currentPath == '/'} ? 'active' : ''">Home</a>
      <a th:href="@{/shop}"
        th:classappend="${currentPath != null && currentPath.contains('/shop')} ? 'active' : ''">Shop</a>
      <a th:href="@{/about}"
        th:classappend="${currentPath != null && currentPath.contains('/about')} ? 'active' : ''">About</a>
        <a th:href="@{/blog}"
        th:classappend="${currentPath != null && currentPath.contains('/blog')} ? 'active' : ''">Blog</a>
      <a th:href="@{/careers}"
        th:classappend="${currentPath != null && currentPath.contains('/careers')} ? 'active' : ''">Careers</a>
      <a th:href="@{/faqs}"
        th:classappend="${currentPath != null && currentPath.contains('/faqs')} ? 'active' : ''">FAQ's</a>
      <a th:href="@{/contact}"
        th:classappend="${currentPath != null && currentPath.contains('/contact')} ? 'active' : ''">Contact</a>
    </nav>

    <!-- ===== USER & CART ===== -->
    <div class="user-cart">

      <!-- ANONYMOUS USER -->
      <div class="user-dropdown" th:unless="${isAuthenticated}">
        <svg width="28" height="28" fill="none" stroke="black" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round" class="user-icon">
          <circle cx="12" cy="8" r="4"></circle>
          <path d="M4 22c0-4 4-6 8-6s8 2 8 6"></path>
        </svg>

        <div class="dropdown-menu">
          <a th:href="@{/login}">Login</a>
          <a th:href="@{/signup}">Register</a>
        </div>
      </div>

      <!-- AUTHENTICATED USER -->
      <div class="user-dropdown" th:if="${isAuthenticated}">
        <svg width="28" height="28" fill="none" stroke="black" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round" class="user-icon">
          <circle cx="12" cy="8" r="4"></circle>
          <path d="M4 22c0-4 4-6 8-6s8 2 8 6"></path>
        </svg>

        <div class="dropdown-menu">
          <div class="user-info">
            <strong th:text="${currentUserFullName ?: currentUserEmail}">User</strong>
            <small th:text="${currentUserEmail}">email</small>
          </div>

          <!-- Complete Profile -->
          <a th:href="@{/profile/setup}" th:if="${currentUser != null && !currentUser.profileCompleted}"
            class="dropdown-link">
            Complete Profile
          </a>

          <!-- My Profile -->
          <a th:href="@{/profile/view}" class="dropdown-link">My Profile</a>

          <!-- Logout -->
          <form th:action="@{/logout}" method="post" style="margin:0;">
            <button type="submit" class="logout-btn">Logout</button>
          </form>
        </div>
      </div>

      <!-- WISHLIST -->
      <a th:href="@{/wishlist/wishlist}" class="cart-link">
        <svg class="cart-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" stroke="black"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20.8 4.6c-1.6-1.4-4-1.4-5.6 0l-.8.8-.8-.8c-1.6-1.4-4-1.4-5.6 0-1.6 1.4-1.6 3.8 0 5.2l6.4 6.4 6.4-6.4c1.6-1.4 1.6-3.8 0-5.2z"></path>
        </svg>
        <span class="badge wishlist-badge" th:text="${wishListItemCount ?: 0}"></span>
      </a>
      <!-- CART -->
      <a th:href="@{/cart/cart}" class="cart-link">
        <svg class="cart-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" stroke="black"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M6 14h20l-2 12H8L6 14z"></path>
          <path d="M10 14l4-6 4 6"></path>
        </svg>
        <span class="badge" th:text="${cartItemCount ?: 0}"></span>
      </a>
    </div>
  </header>
</body>

<script>
  let hoverTimeout;

  document.querySelectorAll('.user-dropdown').forEach(dropdown => {
    const menu = dropdown.querySelector('.dropdown-menu');

    const show = () => {
      clearTimeout(hoverTimeout);
      document.querySelectorAll('.user-dropdown').forEach(d => {
        if (d !== dropdown) d.classList.remove('active');
      });
      dropdown.classList.add('active');
    };

    const hide = () => {
      hoverTimeout = setTimeout(() => {
        dropdown.classList.remove('active');
      }, 300);
    };

    dropdown.addEventListener('click', (e) => {
      e.stopPropagation();
      dropdown.classList.contains('active') ? hide() : show();
    });

    dropdown.addEventListener('mouseenter', show);
    dropdown.addEventListener('mouseleave', hide);
  });

  document.addEventListener('click', () => {
    document.querySelectorAll('.user-dropdown').forEach(d => d.classList.remove('active'));
  });
</script>

</html>