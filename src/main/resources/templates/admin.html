<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion Shop Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<style>
    /* Add to your admin.css file */

    /* Audit Log Badge Styles */
    .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .badge.success {
        background-color: #d1fae5;
        color: #065f46;
        border: 1px solid #6ee7b7;
    }

    .badge.danger {
        background-color: #fee2e2;
        color: #991b1b;
        border: 1px solid #fca5a5;
    }

    .badge.warning {
        background-color: #fef3c7;
        color: #92400e;
        border: 1px solid #fcd34d;
    }

    .badge.info {
        background-color: #dbeafe;
        color: #1e40af;
        border: 1px solid #93c5fd;
    }

    /* Changes Preview */
    .changes-preview {
        display: inline-block;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        cursor: help;
        color: #6b7280;
        font-size: 13px;
    }

    .changes-preview:hover {
        color: #111827;
    }

    /* Filter Group Styling */
    .filter-group {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .filter-select {
        padding: 8px 12px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 14px;
        background-color: white;
        cursor: pointer;
        transition: border-color 0.3s;
    }

    .filter-select:hover {
        border-color: #9ca3af;
    }

    .filter-select:focus {
        outline: none;
        border-color: #dc2626;
    }

    /* Action Buttons */
    .action-btns {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .action-btns form {
        margin: 0;
        display: inline-block;
    }

    .btn-sm {
        padding: 6px 12px;
        font-size: 13px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s;
    }

    .btn-secondary {
        background-color: #6b7280;
        color: white;
    }

    .btn-secondary:hover {
        background-color: #4b5563;
    }

    .btn-danger {
        background-color: #dc2626;
        color: white;
    }

    .btn-danger:hover {
        background-color: #991b1b;
    }

    .btn-primary {
        background-color: #dc2626;
        color: white;
    }

    .btn-primary:hover {
        background-color: #991b1b;
    }

    /* Responsive Table */
    @media (max-width: 1200px) {
        .table-container {
            overflow-x: auto;
        }

        .data-table {
            min-width: 1000px;
        }
    }
</style>
<body>
<!-- Sidebar Navigation -->
<aside class="sidebar">
    <div class="logo">
        <h2>Fashion Shop</h2>
    </div>
    <nav class="nav-menu">
        <a href="#" class="nav-item active" data-section="dashboard">
            <span class="icon">üìä</span>
            Dashboard
        </a>
        <a href="#" class="nav-item" data-section="products">
            <span class="icon">üëï</span>
            Products
        </a>
        <a href="#" class="nav-item" data-section="brands">
            <span class="icon">üè∑Ô∏è</span>
            Brands
        </a>
        <a href="#" class="nav-item" data-section="orders">
            <span class="icon">üì¶</span>
            Orders
        </a>
        <a href="#" class="nav-item" data-section="users">
            <span class="icon">üë•</span>
            Users
        </a>
        <a href="#" class="nav-item" data-section="analytics">
            <span class="icon">üìà</span>
            Analytics
        </a>
        <a href="#" class="nav-item" data-section="auditlog">
            <span class="icon">üìã</span>
            Audit Log
        </a>
    </nav>
</aside>

<!-- Main Content -->
<main class="main-content">
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <button class="menu-toggle" id="menuToggle">‚ò∞</button>
            <div class="header-title-section">
                <h1 id="pageTitle">Dashboard</h1>
                <p class="header-subtitle" id="headerSubtitle">Welcome back, Admin</p>
            </div>
        </div>
        <div class="header-right">
            <!-- Status Info -->
            <div class="status-info">
                <div class="status-item">
                    <span class="status-label">Total Orders Today</span>
                    <span class="status-value" id="ordersToday">12</span>
                </div>
                <div class="status-divider"></div>
                <div class="status-item">
                    <span class="status-label">Revenue Today</span>
                    <span class="status-value" id="revenueToday">$2,450</span>
                </div>
            </div>

            <!-- Search bar -->
            <div class="search-bar">
                <input type="text" placeholder="Search products, orders..." id="searchInput">
                <i class="search-icon">üîç</i>
            </div>

            <!-- Notifications -->
            <div class="notifications">
                <button class="notification-btn" id="notificationBtn">
                    <i class="bell-icon">üîî</i>
                    <span class="notification-badge">3</span>
                </button>
            </div>

            <!-- User Profile -->
            <div class="user-profile">
                <div class="avatar">A</div>
                <div class="user-info">
                    <span class="user-name">Admin</span>
                    <span class="user-role">Administrator</span>
                </div>

                <!-- Dropdown Menu -->
                <div class="profile-dropdown">
                    <button class="dropdown-toggle">‚ãÆ</button>
                    <div class="dropdown-menu">
                        <a href="#" class="dropdown-item">
                            <i>üë§</i> Profile
                        </a>
                        <a href="#" class="dropdown-item">
                            <i>‚öôÔ∏è</i> Settings
                        </a>
                        <div class="dropdown-divider"></div>
                        <form th:action="@{/logout}" method="post" style="margin:0;">
                            <button type="submit" class="dropdown-item logout-item">
                                <i class="bi bi-box-arrow-right"></i> Logout
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Dashboard Section -->
    <section id="dashboard" class="content-section active">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon red">üí∞</div>
                <div class="stat-info">
                    <h3>Total Revenue</h3>
                    <p class="stat-value">$24,580</p>
                    <span class="stat-change positive">+12.5%</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üì¶</div>
                <div class="stat-info">
                    <h3>Orders</h3>
                    <p class="stat-value">342</p>
                    <span class="stat-change positive">+8.2%</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üëï</div>
                <div class="stat-info">
                    <h3>Products</h3>
                    <p class="stat-value">156</p>
                    <span class="stat-change">0%</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-info">
                    <h3>Customers</h3>
                    <p class="stat-value">1,249</p>
                    <span class="stat-change positive">+15.3%</span>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="card">
                <h3>Recent Orders</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Amount</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody id="recentOrdersTable">
                        <tr>
                            <td>#ORD-001</td>
                            <td>John Doe</td>
                            <td>$125.00</td>
                            <td><span class="badge success">Purchased</span></td>
                        </tr>
                        <tr>
                            <td>#ORD-002</td>
                            <td>Jane Smith</td>
                            <td>$89.50</td>
                            <td><span class="badge warning">Pending</span></td>
                        </tr>
                        <tr>
                            <td>#ORD-003</td>
                            <td>Mike Johnson</td>
                            <td>$245.00</td>
                            <td><span class="badge warning">Pending</span></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3>Top Products</h3>
                <div class="product-list">
                    <div class="product-item">
                        <span class="product-name">Classic T-Shirt</span>
                        <span class="product-sales">245 sales</span>
                    </div>
                    <div class="product-item">
                        <span class="product-name">Denim Jeans</span>
                        <span class="product-sales">198 sales</span>
                    </div>
                    <div class="product-item">
                        <span class="product-name">Leather Jacket</span>
                        <span class="product-sales">156 sales</span>
                    </div>
                    <div class="product-item">
                        <span class="product-name">Summer Dress</span>
                        <span class="product-sales">143 sales</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section id="products" class="content-section">
        <div class="section-header">
            <h2>Products Management</h2>
            <button class="btn btn-primary" id="addProductBtn">+ Add Product</button>
        </div>

        <div class="card">
            <div class="table-container">
                <table class="data-table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Price</th>
                        <th>Stock</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="productsTable">
                    <!-- Products will be populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Brands Section -->
    <section id="brands" class="content-section">
        <div class="section-header">
            <h2>Brand Management</h2>
            <button class="btn btn-primary" id="addBrandBtn">+ Add Brand</button>
        </div>

        <div class="card">
            <div class="table-container">
                <table class="data-table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Slug</th>
                        <th>Created At</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="brand : ${brands}">
                        <td th:text="${brand.id}"></td>
                        <td th:text="${brand.name}"></td>
                        <td th:text="${brand.slug}"></td>
                        <td th:text="${#temporals.format(brand.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                        <td>
                            <div class="action-btns">
                                <button class="btn btn-sm btn-secondary" th:onclick="'editBrand(' + ${brand.id} + ')'">Edit</button>
                                <form th:action="@{/admin/brands/{id}/delete(id=${brand.id})}" method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this brand?')">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Orders Section -->
    <section id="orders" class="content-section">
        <div class="section-header">
            <h2>Orders Management</h2>
            <div class="filter-group">
                <select class="filter-select" id="orderStatus">
                    <option value="all">All Status</option>
                    <option value="pending">Pending</option>
                    <option value="shipped">Shipped</option>
                    <option value="delivered">Delivered</option>
                </select>
            </div>
        </div>

        <div class="card">
            <div class="table-container">
                <table class="data-table">
                    <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Customer</th>
                        <th>Date</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="ordersTable">
                    <!-- Orders will be populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Users Section -->
    <section id="users" class="content-section">
        <div class="section-header">
            <h2>Users Management</h2>
        </div>

        <div class="card">
            <div class="table-container">
                <table class="data-table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Active</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="user : ${users}">
                        <td th:text="${user.id}"></td>
                        <td th:text="${user.fullName}"></td>
                        <td th:text="${user.email}"></td>
                        <td th:text="${user.role.code}"></td>
                        <td th:text="${user.active} ? 'Yes' : 'No'"></td>
                        <td>
                            <div class="action-btns">
                                <button class="btn btn-sm btn-secondary" th:onclick="'viewUser(' + ${user.id} + ')'">View</button>
                                <form th:action="@{/admin/users/${user.id}/edit-role}" method="post">
                                    <select name="roleCode">
                                        <option value="ROLE_USER">User</option>
                                        <option value="ROLE_ADMIN">Admin</option>
                                    </select>
                                    <button type="submit" class="btn btn-sm btn-primary">Update Role</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Analytics Section -->
    <section id="analytics" class="content-section">
        <div class="section-header">
            <h2>Analytics</h2>
        </div>

        <div class="analytics-grid">
            <div class="card">
                <h3>Sales Overview</h3>
                <div class="chart-placeholder">
                    <p>üìà Sales chart visualization</p>
                    <p class="chart-note">Connect to your Spring Boot backend to display real-time data</p>
                </div>
            </div>
            <div class="card">
                <h3>Category Distribution</h3>
                <div class="category-stats">
                    <div class="category-item">
                        <span class="category-name">T-Shirts</span>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 45%"></div>
                        </div>
                        <span class="category-percent">45%</span>
                    </div>
                    <div class="category-item">
                        <span class="category-name">Jeans</span>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 30%"></div>
                        </div>
                        <span class="category-percent">30%</span>
                    </div>
                    <div class="category-item">
                        <span class="category-name">Jackets</span>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 15%"></div>
                        </div>
                        <span class="category-percent">15%</span>
                    </div>
                    <div class="category-item">
                        <span class="category-name">Accessories</span>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 10%"></div>
                        </div>
                        <span class="category-percent">10%</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Audit Log Section -->
    <section id="auditlog" class="content-section">
        <div class="section-header">
            <h2>Audit Log</h2>
            <div class="filter-group">
                <select class="filter-select" id="auditAction">
                    <option value="all">All Actions</option>
                    <option value="CREATE">Create</option>
                    <option value="UPDATE">Update</option>
                    <option value="DELETE">Delete</option>
                    <option value="VIEW">View</option>
                </select>
                <select class="filter-select" id="auditEntity">
                    <option value="all">All Entities</option>
                    <option value="Product">Product</option>
                    <option value="Brand">Brand</option>
                    <option value="Order">Order</option>
                    <option value="User">User</option>
                </select>
                <input type="date" class="filter-select" id="auditDate">
            </div>
        </div>

        <div class="card">
            <div class="table-container">
                <table class="data-table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Actor</th>
                        <th>Role</th>
                        <th>Action</th>
                        <th>Entity</th>
                        <th>Changes</th>
                        <th>Timestamp</th>
                    </tr>
                    </thead>
                    <tbody id="auditLogTable">
                    <tr th:each="log : ${auditLogs}">
                        <td th:text="${log.id}"></td>
                        <td th:text="${log.actor != null ? log.actor.fullName : 'System'}"></td>
                        <td th:text="${log.actorRole}"></td>
                        <td>
                                    <span class="badge"
                                          th:classappend="${log.action == 'CREATE' ? 'success' : (log.action == 'DELETE' ? 'danger' : (log.action == 'UPDATE' ? 'warning' : 'info'))}"
                                          th:text="${log.action}"></span>
                        </td>
                        <td th:text="${log.entity}"></td>
                        <td>
                            <span class="changes-preview" th:title="${log.changes}" th:text="${#strings.abbreviate(log.changes, 50)}"></span>
                        </td>
                        <td th:text="${#temporals.format(log.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
</main>

<!-- Modal for Add/Edit Product -->
<div id="productModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Add New Product</h2>
            <button class="close-modal">&times;</button>
        </div>
        <form id="productForm">
            <div class="form-group">
                <label>Product Name</label>
                <input type="text" id="productName" required>
            </div>
            <div class="form-group">
                <label>Category</label>
                <select id="productCategory" required>
                    <option value="">Select Category</option>
                    <option value="T-Shirts">T-Shirts</option>
                    <option value="Jeans">Jeans</option>
                    <option value="Jackets">Jackets</option>
                    <option value="Accessories">Accessories</option>
                </select>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Price ($)</label>
                    <input type="number" id="productPrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Stock</label>
                    <input type="number" id="productStock" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Product</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal for Add/Edit Brand -->
<div id="brandModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="brandModalTitle">Add New Brand</h2>
            <button class="close-modal" onclick="closeBrandModal()">&times;</button>
        </div>
        <form th:action="@{/admin/brands/save}" method="post" id="brandForm">
            <input type="hidden" id="brandId" name="id">
            <div class="form-group">
                <label>Brand Name</label>
                <input type="text" id="brandName" name="name" required maxlength="150" placeholder="e.g., Nike, Adidas">
            </div>
            <div class="form-group">
                <label>Slug</label>
                <input type="text" id="brandSlug" name="slug" required maxlength="150" placeholder="e.g., nike, adidas">
                <small style="color: #6b7280; font-size: 12px;">URL-friendly version (lowercase, no spaces)</small>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal" onclick="closeBrandModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Brand</button>
            </div>
        </form>
    </div>
</div>

<script th:src="@{/js/admin.js}"></script>
<script>
    // Brand Management Functions
    document.getElementById('addBrandBtn')?.addEventListener('click', function() {
        document.getElementById('brandModalTitle').textContent = 'Add New Brand';
        document.getElementById('brandForm').reset();
        document.getElementById('brandId').value = '';
        document.getElementById('brandModal').style.display = 'flex';
    });

    function editBrand(id) {
        // Fetch brand data and populate form
        fetch(`/admin/brands/${id}`)
            .then(response => response.json())
            .then(brand => {
                document.getElementById('brandModalTitle').textContent = 'Edit Brand';
                document.getElementById('brandId').value = brand.id;
                document.getElementById('brandName').value = brand.name;
                document.getElementById('brandSlug').value = brand.slug;
                document.getElementById('brandModal').style.display = 'flex';
            })
            .catch(error => {
                alert('Error loading brand data');
                console.error(error);
            });
    }

    function closeBrandModal() {
        document.getElementById('brandModal').style.display = 'none';
    }

    // Auto-generate slug from name
    document.getElementById('brandName')?.addEventListener('input', function(e) {
        const slug = e.target.value
            .toLowerCase()
            .replace(/[^a-z0-9]+/g, '-')
            .replace(/^-+|-+$/g, '');
        document.getElementById('brandSlug').value = slug;
    });

    // Close modal when clicking outside
    window.addEventListener('click', function(e) {
        const brandModal = document.getElementById('brandModal');
        if (e.target === brandModal) {
            closeBrandModal();
        }
    });
</script>
</body>

</html>